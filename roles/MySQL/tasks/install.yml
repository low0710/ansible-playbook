- name: install mysql repo local
 shell: sudo yum localinstall -y https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm
 args:
    chdir: "{{ rpm_dir }}"

- name: install mysql
yum: name=mysql-community-server 
state: present

- name: enable mysql
shell: sudo systemctl enable mysqld

- name: start mysql
shell: sudo systemctl start mysqld

- name: install keep-alive 
yum: name=keepalived
state: present

- name: enable keep-alive
shell: sudo systemctl enable keepalived 

- name: "Compile keepalived service"
  template: src=keepalived.conf.template dest="{{ KEEPALIVED_CONFIG_FILE_PATH | mandatory }}"
  when: "'mysql_master' in group_names"


- name: "Start keepalived serivice"
  systemd:
    state: restarted
    daemon_reload: yes
    name: "{{ KEEPALIVED_SERVICE_NAME | mandatory }}"
    enabled: yes
  when: "'mysql_master' in group_names











